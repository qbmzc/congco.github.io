---
title: JVM｜MaxDirectMemorySize
date: 2021-3-9
categories:
  - Java
tags:
  - JVM
---

![bg](https://gitee.com/snowyan/image/raw/master/2021/202110131102827.png)

<!-- more -->

## 问题

运维的同事反映，生产环境的服务器内存超过90%的占用，jvm相关配置如下

## 配置

```bash
-server -Xms12g -Xmx12g -XX:+UseG1GC -XX:MaxGCPauseMillis=200  -verbose:gc -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -Dspring.profiles.active=PROD -XX:CompressedClassSpaceSize=1g 
```

物理机内存为16G,该服务为文件服务，文件上传中有使用到直接内存（堆外内存）。

```bash
# 设置堆外内存大小
-XX:MaxDirectMemorySize=2g
```

## 参考资料

- [JVM源码分析之堆外内存完全解读](http://lovestblog.cn/blog/2015/05/12/direct-buffer/)
- [堆外内存 之 DirectByteBuffer 详解](https://www.jianshu.com/p/007052ee3773)
