---
title: ThreadLocal
date: 2019-10-08
tags:
  - Java
  - ThreadLocal
categories:
  - Java
---

[![ufc91K.md.jpg](https://s2.ax1x.com/2019/10/08/ufc91K.md.jpg)](https://imgchr.com/i/ufc91K)

## ThreadLocal的简单使用

```java
 private static final  SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
 public static class ParseDate implements Runnable{
    int i=0;
    public ParseDate(int i){this.i=i;}
    public void run() {
        try {
            Date t=sdf.parse("2015-03-29 19:29:"+i%60);
            System.out.println(i+":"+t);
        } catch (ParseException e) {
            e.printStackTrace();
        }
     }
 }
public static void main(String[] args) {
    ExecutorService es=Executors.newFixedThreadPool(10);
    for(int i=0;i＜1000;i++){
        es.execute(new ParseDate(i));
    }
 }
```

`SimipleDateFormat.parse()`方法并不是线程安全的。因此，在线程池中共享这个对象必然导致错误。

```java
static ThreadLocal＜SimpleDateFormat＞ tl=new ThreadLocal＜SimpleDateFormat＞();
public static class ParseDate implements Runnable{
    int i=0;
    public ParseDate(int i){this.i=i;}
    public void run() {
        try {
            if(tl.get()==null){
                tl.set(new SimpleDateFormat("yyyy-MM-dd HH:mm:ss"));
            }
            Date t=tl.get().parse("2015-03-29 19:29:"+i%60);
            System.out.println(i+":"+t);
        } catch (ParseException e) {
            e.printStackTrace();
        }
    }
}
```

