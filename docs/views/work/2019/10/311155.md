---
title: 一个处理excel文件的工具 
date: 2019-10-31
tags:
  - pandas
  - tkinter
categories:
  - Python 
---

![K8Yr2n.jpg](https://s2.ax1x.com/2019/10/22/K8Yr2n.jpg)

## 需求分析

上传excel文件,读取获得时间,比较时间获取单据是否超时.将判断结果回写到excel中.

## 环境

```bash
OS: Manjaro
IDE: PyCharm
```

## 代码实现

```python
#!/usr/bin/python
# -*- coding: utf-8 -*-
from tkinter import *
# 导入ttk
from tkinter import ttk
# 导入filedialog
from tkinter import filedialog
import pandas as pd
import time
import datetime
from tkinter import messagebox


class App:
    def __init__(self, master):
        self.master = master
        self.initWidgets()

    def initWidgets(self):
        # 创建按钮，并为之绑定事件处理函数
        ttk.Button(self.master, text='Open EXCEL',
                   command=self.open_file  # 绑定open_file方法
                   ).pack(side=BOTTOM, ipadx=150, ipady=100)

    def open_file(self):
        # 调用askopenfile方法获取单个打开的文件
        file_path = filedialog.askopenfilename(title='打开单个文件',
                                               filetypes=[("office10-19", "*.xlsx"), ('office03-07', '*.xls')],
                                               # 只处理的文件类型
                                               initialdir='./')  # 初始目录
        self.exec_file(file_path)
        messagebox.showinfo("提示", "修改完成")

    def exec_file(self, file_name):
        f = pd.read_excel(file_name, header=0)
        df = pd.DataFrame(f)
        new_name = datetime.datetime.now().strftime('%Y-%m-%d') + ".xlsx"
        data = []

        for row in df.itertuples(name="RowData"):
            order_time = row[1]  # 下单时间
            receive_time = row[4]  # 妥投时间
            aging = row[13]  # 时效
            t4 = datetime.datetime.strptime(receive_time, "%Y-%m-%d %H:%M:%S")
            t5 = datetime.datetime.strptime(order_time, "%Y-%m-%d %H:%M:%S")
            result = t4.__sub__(t5)
            if result.seconds > aging * 60 * 60:
                data.append('是')
            else:
                data.append('否')

            # 判断每一条记录'是否超时'
        f['是否超时'] = data
        f.to_excel(file_name, "明细表", index=False, header=True)


root = Tk()
root.title("时效性校验")
App(root)
root.mainloop()
```

## 打包

使用`pyinstaller`打包成exe文件,需要在Windows环境下打包.

安装

```bash
conda install pyinstaller
```

打包

```bash
pyinstaller -F -w --icon=myIcon.ico *.py
```

参见`pyinstaller`的命令相关说明
