---
title: docker使用RexRay挂载S3
date: 2024-12-24
tags:
  - docker
  - s3
categories: Linux
toc: true
author: cong
---
在 Spring Boot 应用中，使用 EXPOSE 5000 配置 Dockerfile 中的端口主要用于声明容器需要监听的端口。要让你的 Spring Boot 应用在容器中绑定到该端口，可以按照以下步骤操作：

  

**1. 配置 Spring Boot 应用的端口**

  

Spring Boot 默认监听端口是 8080，你需要将其更改为 5000 来匹配 Docker 的 EXPOSE 5000。有几种方式可以实现：

  

**(1) 修改 application.properties 或 application.yml**

  

在 src/main/resources/application.properties 中添加：

  

server.port=5000

  

或在 application.yml 中：

  

server:

  port: 5000

  

**(2) 通过命令行参数设置**

  

运行 Spring Boot 应用时，可以使用 JVM 参数覆盖默认端口：

  

java -jar myapp.jar --server.port=5000

  

在 Docker 中，可以通过 CMD 或 ENTRYPOINT 配置此参数。

  

**(3) 使用环境变量**

  

Spring Boot 支持通过环境变量设置端口。你可以在 application.properties 中定义：

  

server.port=${PORT:8080}

  

这样可以通过环境变量 PORT 覆盖默认端口：

  

docker run -e PORT=5000 your-image

  

**2. 编写 Dockerfile**

  

以下是一个示例 Dockerfile，将 Spring Boot 应用与端口 5000 结合起来：

  

_# 使用官方 Maven 构建镜像_

FROM openjdk:17-jdk-slim

  

_# 设置工作目录_

WORKDIR /app

  

_# 复制 Spring Boot JAR 文件到容器中_

COPY target/myapp.jar /app/myapp.jar

  

_# 暴露 5000 端口（供外部服务使用）_

EXPOSE 5000

  

_# 设置容器启动命令并指定端口_

ENTRYPOINT ["java", "-jar", "myapp.jar", "--server.port=5000"]

  

**3. 构建和运行 Docker 镜像**

  

**(1) 构建镜像**

  

运行以下命令构建 Docker 镜像：

  

docker build -t my-spring-app .

  

**(2) 运行容器**

  

运行容器并将外部端口映射到容器的 5000 端口：

  

docker run -p 5000:5000 my-spring-app

  

**4. 验证应用**

  

访问浏览器或工具（如 curl）检查 Spring Boot 应用是否正常运行：

  

curl http://localhost:5000

  

如果正常返回响应，说明配置成功。

  

**5. 最佳实践**

  

**使用动态端口**

  

在 application.properties 中使用动态端口配置：

  

server.port=${PORT:8080}

  

然后通过 Docker 运行时传递 PORT 环境变量：

  

docker run -e PORT=5000 -p 5000:5000 my-spring-app

  

**Docker Compose 集成**

  

可以将 EXPOSE 和端口映射写入 docker-compose.yml：

  

version: '3.8'

services:

  app:

    build: .

    ports:

      - "5000:5000"

    environment:

      - PORT=5000

  

这样配置后，Spring Boot 应用就能正常使用 EXPOSE 5000 声明的端口，并通过 Docker 将服务暴露给外部。